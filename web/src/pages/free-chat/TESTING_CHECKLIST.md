# FreeChat 功能测试清单

## 🎯 测试目的

确保所有FreeChat功能在引入Zustand Store后仍然正常工作。

---

## ✅ 核心功能测试

### 1. 页面加载

- [ ] 打开 `/free-chat` 页面
- [ ] 页面正常渲染，无错误
- [ ] 左侧边栏显示
- [ ] 中间聊天区域显示
- [ ] 右侧控制面板显示

**预期结果**: 页面完整加载，无console错误

---

### 2. 用户认证

#### 2.1 URL参数认证
- [ ] 访问 `/free-chat?user_id=xxx&auth=yyy`
- [ ] 用户ID正确识别
- [ ] 设置正常加载

#### 2.2 Session认证
- [ ] 已登录用户访问 `/free-chat`
- [ ] 自动获取用户信息
- [ ] 设置正常加载

**预期结果**: 两种认证方式都能正常工作

---

### 3. 助手管理

#### 3.1 选择助手
- [ ] 左侧"助手"标签显示Model Card列表
- [ ] 点击助手卡片
- [ ] 自动创建新会话
- [ ] 会话关联到选中的助手
- [ ] 输入框变为可用状态

**预期结果**: 
- ✅ 输入框启用
- ✅ 会话有 `model_card_id`
- ✅ 会话显示在"话题"列表

#### 3.2 切换助手
- [ ] 已有会话时选择不同助手
- [ ] 创建新会话
- [ ] 新会话关联到新助手
- [ ] 可以在不同助手的会话间切换

**预期结果**: 每个会话保持自己的助手ID

---

### 4. 话题(会话)管理

#### 4.1 创建会话
- [ ] 点击"新建对话"按钮
- [ ] 新会话创建成功
- [ ] 新会话置顶显示
- [ ] 自动切换到新会话
- [ ] 输入框可用

**关键**: 新会话必须有 `model_card_id`

#### 4.2 切换会话
- [ ] 点击不同的会话
- [ ] 消息正确切换
- [ ] 输入框状态正确
- [ ] 参数面板显示当前会话参数

**预期结果**: 消息和参数正确加载

#### 4.3 重命名会话
- [ ] 双击会话名称
- [ ] 输入新名称
- [ ] 按Enter保存
- [ ] 名称立即更新
- [ ] 刷新页面后名称保持

**预期结果**: 名称持久化保存

#### 4.4 删除会话
- [ ] 点击会话删除按钮
- [ ] 确认删除
- [ ] 会话从列表移除
- [ ] 自动切换到下一个会话(如果有)

**预期结果**: 删除后数据同步

---

### 5. 消息发送和接收

#### 5.1 发送消息
- [ ] 选择助手
- [ ] 在输入框输入消息
- [ ] 按Enter发送
- [ ] 用户消息显示在聊天区域
- [ ] AI回复流式显示

**预期结果**: 消息正常发送和接收

#### 5.2 流式响应
- [ ] 发送消息后观察AI回复
- [ ] 回复逐字显示
- [ ] 可以随时点击"停止"
- [ ] 停止后回复保持当前内容

**预期结果**: SSE流式响应正常

#### 5.3 消息历史
- [ ] 发送多条消息
- [ ] 切换到其他会话
- [ ] 切换回来
- [ ] 消息历史完整显示

**预期结果**: 消息不丢失

#### 5.4 清空消息
- [ ] 点击"清空对话"
- [ ] 确认清空
- [ ] 当前会话消息清空
- [ ] 其他会话不受影响

**预期结果**: 只清空当前会话

---

### 6. 知识库管理

#### 6.1 选择知识库
- [ ] 右侧控制面板打开
- [ ] 显示知识库列表
- [ ] 选择/取消选择知识库
- [ ] 发送消息时使用选中的知识库

**预期结果**: 知识库选择生效

#### 6.2 切换会话保持知识库
- [ ] 选择知识库
- [ ] 切换到另一个会话
- [ ] 切换回来
- [ ] 知识库选择保持(如果需要)

---

### 7. 参数调整

#### 7.1 调整Temperature
- [ ] 打开控制面板
- [ ] 调整Temperature滑块
- [ ] 发送消息
- [ ] 后端使用新的Temperature值

**预期结果**: 参数生效

#### 7.2 调整Top P
- [ ] 调整Top P滑块
- [ ] 发送消息验证

#### 7.3 自定义Role Prompt
- [ ] 输入自定义系统提示词
- [ ] 发送消息
- [ ] AI按照新提示词回复

**预期结果**: 所有参数正常工作

#### 7.4 参数持久化
- [ ] 调整参数
- [ ] 刷新页面
- [ ] 参数设置保持

**预期结果**: 参数持久化

---

### 8. 数据持久化

#### 8.1 localStorage持久化 (新功能)
- [ ] 创建多个会话
- [ ] 发送多条消息
- [ ] 关闭浏览器标签
- [ ] 重新打开 `/free-chat`
- [ ] 检查localStorage:
  - `freechat-session-storage`
  - `freechat-message-storage`
- [ ] 会话和消息恢复

**预期结果**: 
- ✅ localStorage有数据
- ✅ 会话恢复
- ✅ 消息恢复

#### 8.2 服务器持久化
- [ ] 创建会话并发送消息
- [ ] 等待5秒(防抖时间)
- [ ] 检查网络请求
- [ ] 数据保存到后端

**预期结果**: 数据同步到服务器

#### 8.3 多设备同步
- [ ] 设备A创建会话
- [ ] 设备B刷新页面
- [ ] 设备B看到新会话

**注意**: 当前可能不支持实时同步，需要刷新

---

### 9. URL参数处理

#### 9.1 dialog_id参数
- [ ] 访问 `/free-chat?dialog_id=xxx`
- [ ] dialogId正确设置
- [ ] 使用正确的Bot

#### 9.2 conversation_id参数
- [ ] 访问 `/free-chat?conversation_id=xxx`
- [ ] 加载指定对话
- [ ] 消息历史显示
- [ ] 创建新会话并自动切换

**预期结果**: URL参数正确处理

#### 9.3 language参数
- [ ] 访问 `/free-chat?language=en`
- [ ] 界面切换到英文
- [ ] 访问 `/free-chat?language=zhcn`
- [ ] 界面切换到中文

**预期结果**: 语言切换正常

---

### 10. 错误处理

#### 10.1 网络错误
- [ ] 断开网络
- [ ] 尝试发送消息
- [ ] 显示错误提示
- [ ] 消息不丢失

**预期结果**: 友好的错误提示

#### 10.2 无助手时发送
- [ ] 不选择任何助手
- [ ] 尝试发送消息
- [ ] 显示"请先选择助手"提示

**预期结果**: 
- ❌ 旧实现: 输入框禁用
- ✅ 新实现: 输入框可用但发送时提示

#### 10.3 对话创建失败
- [ ] 模拟后端错误
- [ ] 尝试发送第一条消息
- [ ] 显示创建对话失败
- [ ] 消息不保留在界面

**预期结果**: 错误恢复正常

---

### 11. 性能测试

#### 11.1 大量会话
- [ ] 创建20+个会话
- [ ] 每个会话发送5+条消息
- [ ] 观察页面性能
- [ ] 切换会话是否流畅

**预期结果**: 
- 页面不卡顿
- 切换流畅
- 内存使用合理

#### 11.2 长消息历史
- [ ] 在一个会话中发送100+条消息
- [ ] 滚动消息列表
- [ ] 切换到其他会话再切回

**预期结果**: 
- 渲染流畅
- 无性能问题

---

### 12. Redux DevTools (新功能)

#### 12.1 DevTools连接
- [ ] 打开Chrome DevTools
- [ ] 切换到Redux标签
- [ ] 看到两个Store:
  - `FreeChat_Session`
  - `FreeChat_Message`

**预期结果**: DevTools显示状态

#### 12.2 查看State
- [ ] 查看sessions数组
- [ ] 查看messages对象
- [ ] 查看currentSessionId

**预期结果**: 状态数据完整

#### 12.3 查看Actions
- [ ] 创建会话
- [ ] DevTools显示 `createSession` action
- [ ] 发送消息
- [ ] DevTools显示 `addMessage` action

**预期结果**: 所有操作都被记录

#### 12.4 时间旅行
- [ ] 执行多个操作
- [ ] 在DevTools中回退到之前的状态
- [ ] 页面状态相应变化

**预期结果**: 时间旅行调试正常

---

### 13. 向后兼容性

#### 13.1 旧Hook仍可用
- [ ] `useFreeChat` 仍然导出
- [ ] 原有功能正常
- [ ] 无破坏性变更

**预期结果**: 现有代码无需修改

#### 13.2 数据格式兼容
- [ ] 旧的localStorage数据可以读取
- [ ] 旧的API响应可以解析
- [ ] 新旧数据可以共存

**预期结果**: 平滑迁移

---

## 🐛 已知问题检查

### Bug #1: 输入框第一次提问后消失
- [ ] 选择助手
- [ ] 发送第一条消息
- [ ] **检查**: 输入框仍然可用 ✅
- [ ] 发送第二条消息
- [ ] **检查**: 输入框仍然可用 ✅

**预期**: ✅ 已修复，输入框不再禁用

### Bug #2: 新建会话model_card_id丢失
- [ ] 不选择助手
- [ ] 点击"新建对话"
- [ ] **检查**: 自动使用第一个Model Card ✅
- [ ] 如果没有Model Card
- [ ] **检查**: 显示警告提示 ✅

**预期**: ✅ 已修复，有fallback逻辑

### Bug #3: 消息切换不同步
- [ ] 创建两个会话A和B
- [ ] 在A中发送消息
- [ ] 切换到B
- [ ] 切换回A
- [ ] **检查**: A的消息完整显示 ✅

**预期**: ✅ 已修复，消息正确同步

---

## 📊 测试报告模板

```markdown
## FreeChat 测试报告

**测试日期**: YYYY-MM-DD
**测试人**: XXX
**浏览器**: Chrome/Firefox/Safari XX.X

### 测试结果总览

| 类别 | 通过 | 失败 | 跳过 |
|------|------|------|------|
| 页面加载 | X/Y | | |
| 用户认证 | X/Y | | |
| 助手管理 | X/Y | | |
| 话题管理 | X/Y | | |
| 消息功能 | X/Y | | |
| 知识库 | X/Y | | |
| 参数调整 | X/Y | | |
| 数据持久化 | X/Y | | |
| URL参数 | X/Y | | |
| 错误处理 | X/Y | | |
| 性能测试 | X/Y | | |
| DevTools | X/Y | | |
| 向后兼容 | X/Y | | |
| Bug修复验证 | X/Y | | |

### 发现的问题

1. **问题描述**: ...
   - 严重程度: 高/中/低
   - 复现步骤: ...
   - 预期行为: ...
   - 实际行为: ...

### 测试结论

- [ ] ✅ 所有核心功能正常
- [ ] ⚠️ 部分功能有问题
- [ ] ❌ 存在严重问题

### 建议

...
```

---

## 🎯 快速测试路径

### 最小测试 (5分钟)
1. 打开页面
2. 选择助手
3. 发送消息
4. 切换会话
5. 刷新页面验证持久化

### 标准测试 (30分钟)
- 执行核心功能测试 1-9

### 完整测试 (2小时)
- 执行所有测试项

---

**提示**: 建议在以下浏览器中测试
- ✅ Chrome (最新版)
- ✅ Firefox (最新版)
- ✅ Safari (最新版)
- ✅ Edge (最新版)
